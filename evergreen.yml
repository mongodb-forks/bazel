functions:
  "fetch source" :
    - command: git.get_project
      params:
        directory: src
  
tasks:
- name: build
  depends_on: []
  commands:
    - func: "fetch source"
    - command: shell.exec
      working_dir: src
      params:
        script: |
          podman pull docker.io/redhat/ubi8:8.10-1184 
          systemctl --user enable podman.socket
          systemctl --user start podman.socket
          systemctl --user status podman.socket
          /opt/mongodbtoolchain/v4/bin/python3 -m virtualenv venv
          source ./venv/bin/activate
          ./venv/bin/python3 -m pip install podman
          ./venv/bin/python3 src/mongo_linux_build.py 
          ./src/mongo_bazel info

buildvariants:

- name: linux_x86_64
  display_name: Linux x86_64
  run_on:
  - rhel8.8-large
  tasks:
  - name: build

- name: linux_arm64
  display_name: Linux arm64
  run_on:
  - rhel8.8-arm64-large
  tasks:
  - name: build

- name: linux_s390x
  display_name: Linux s390x
  run_on:
  - rhel83-zseries-small
  tasks:
  - name: build

- name: linux_ppc
  display_name: Linux PPC
  run_on:
  - rhel81-power8-small
  tasks:
  - name: build